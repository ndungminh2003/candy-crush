(()=>{"use strict";var e,t={113:(e,t,i)=>{i(440);class s extends Phaser.Scene{constructor(){super({key:"BootScene"})}preload(){this.cameras.main.setBackgroundColor(10016391),this.createLoadingbar(),this.load.on("progress",(e=>{this.progressBar.clear(),this.progressBar.fillStyle(16774867,1),this.progressBar.fillRect(this.cameras.main.width/4,this.cameras.main.height/2-16,this.cameras.main.width/2*e,16)}),this),this.load.on("complete",(()=>{this.progressBar.destroy(),this.loadingBar.destroy()}),this),this.load.pack("preload","./assets/pack.json","preload")}update(){this.scene.start("GameScene")}createLoadingbar(){this.loadingBar=this.add.graphics(),this.loadingBar.fillStyle(6139463,1),this.loadingBar.fillRect(this.cameras.main.width/4-2,this.cameras.main.height/2-18,this.cameras.main.width/2+4,20),this.progressBar=this.add.graphics()}}let l={score:0,highscore:0,gridRows:8,gridColumns:8,tileWidth:64,tileHeight:72,candyTypes:["cookie1","cookie2","croissant","cupcake"]};class h extends Phaser.GameObjects.Image{constructor(e){super(e.scene,e.x,e.y,e.texture,e.frame),this.isSelect=!1,this.isCombine4=!1,this.isCombine5=!1,this.init()}init(){this.setOrigin(.5,.5),this.setInteractive(),this.scene.add.existing(this),this.tweenSelected=this.scene.add.tween({targets:this,angle:360,yoyo:!0,loop:-1}),this.tweenSelected.pause()}getSelected(){this.isSelect||this.tweenSelected.play(),this.isSelect=!0}getDeselected(){this.isSelect&&(this.tweenSelected.pause(),this.angle=0,this.isSelect=!1)}explode3(){this.scene.add.particles(this.x,this.y,"flare",{lifespan:4e3,speed:{min:250,max:500},scale:{start:.4,end:0},gravityY:150,blendMode:"ADD",emitting:!1}).explode(15)}enableCombine4(){this.isCombine4=!0,this.particleCombine4=this.scene.add.particles(this.x,this.y,"flare",{color:[16436258,16291840,16266752,10421252],colorEase:"quad.out",lifespan:1e3,angle:{min:-100,max:-80},scale:{start:.7,end:0,ease:"sine.out"},speed:100,advance:2e3,blendMode:"ADD"}).startFollow(this,-this.x,-this.y).setDepth(-1)}enableCombine5(){this.isCombine5=!0,this.particleCombine4=this.scene.add.particles(this.x,this.y,"flare",{color:[16738740,255],colorEase:"quad.out",lifespan:1e3,angle:{min:-100,max:-80},scale:{start:.7,end:0,ease:"sine.out"},speed:100,advance:2e3,blendMode:"ADD"}).startFollow(this,-this.x,-this.y).setDepth(-1)}disableCombine4(){this.isCombine4=!1,this.particleCombine4&&this.particleCombine4.stop()}disableCombine5(){this.isCombine5=!1,this.particleCombine5&&this.particleCombine5.stop()}getParticleCombine4(){return this.particleCombine4}getParticleCombine5(){return this.particleCombine5}getIsCombine4(){return this.isCombine4}getIsCombine5(){return this.isCombine5}}class r{constructor(e){this.scene=e,this.init()}init(){this.pool=[]}static getInstance(e){return r.instance||(r.instance=new r(e)),r.instance}getTile(e,t){if(this.pool.length>0){let i=this.pool.pop();return i.setVisible(!0),i.setTexture(l.candyTypes[Phaser.Math.RND.between(0,l.candyTypes.length-1)]),i.setPosition(e*l.tileWidth+l.tileWidth/2,t*l.tileHeight+l.tileHeight/2),i}let i=l.candyTypes[Phaser.Math.RND.between(0,l.candyTypes.length-1)];return new h({scene:this.scene,x:e*l.tileWidth+l.tileWidth/2,y:t*l.tileHeight+l.tileHeight/2,texture:i})}returnTile(e){e.setPosition(-1,-1),e.setVisible(!1),this.pool.push(e)}getPool(){return this.pool}clear(){this.pool=[]}}class n extends Phaser.GameObjects.Container{constructor(e){super(e),this.init()}init(){this.tileGrid=[];for(let e=0;e<l.gridRows;e++){this.tileGrid[e]=[];for(let t=0;t<l.gridColumns;t++)this.tileGrid[e][t]=this.addTile(t,e)}}addTile(e,t){let i=l.candyTypes[Phaser.Math.RND.between(0,l.candyTypes.length-1)];return new h({scene:this.scene,x:e*l.tileWidth+l.tileWidth/2,y:t*l.tileHeight+l.tileHeight/2,texture:i})}getTileGrid(){return this.tileGrid}playIdleAnimation(){if(this.idleTween)return;let e=0;this.tileGrid.flat().filter((e=>void 0!==e)).forEach((t=>{this.scene.tweens.add({targets:t,scale:1.2,ease:"sine.inout",duration:300,delay:50*e,repeat:0,yoyo:!0,repeatDelay:500}),e++,e%12==0&&(e=0)}))}stopIdleAnimation(){this.idleTween&&(this.idleTween.stop(),this.idleTween=void 0)}getTilePos(e,t){let i={x:-1,y:-1};for(let s=0;s<e.length;s++)for(let l=0;l<e[s].length;l++)if(t===e[s][l]){i.x=l,i.y=s;break}return i}handleExplode(e){void 0!==e&&this.emit3(e)}emit4(e){let t=this.getTilePos(this.tileGrid,e);e.enableCombine4(),this.tileGrid[t.y][t.x]=void 0}emit5(e){}emit3(e){let t=this.getTilePos(this.tileGrid,e);e.explode3(),r.getInstance(this.scene).returnTile(e),this.tileGrid[t.y][t.x]=void 0}}class d extends Phaser.Scene{constructor(){super({key:"GameScene"}),this.visited=[]}init(){this.canMove=!0;for(let e=0;e<l.gridRows;e++){this.visited[e]=[];for(let t=0;t<l.gridColumns;t++)this.visited[e][t]=!1}this.cameras.main.setBackgroundColor(7908062),this.tileGrid=new n(this),this.firstSelectedTile=void 0,this.secondSelectedTile=void 0,this.input.on("gameobjectdown",this.tileDown,this),this.checkMatches(),this.resetIdleTimer()}resetIdleTimer(){this.idleTimer&&this.idleTimer.remove(!1),this.idleTimer=this.time.addEvent({delay:1e4,callback:()=>this.playIdleAnimation(),callbackScope:this,loop:!0})}playIdleAnimation(){this.tileGrid.playIdleAnimation()}stopIdleAnimation(){this.tileGrid.stopIdleAnimation()}tileDown(e,t,i){if(this.resetIdleTimer(),this.stopIdleAnimation(),this.canMove)if(this.firstSelectedTile){if(this.secondSelectedTile=t,this.firstSelectedTile===this.secondSelectedTile)return this.firstSelectedTile.getDeselected(),console.log("unpick"),this.firstSelectedTile=void 0,void(this.secondSelectedTile=void 0);let e=Math.abs(this.firstSelectedTile.x-this.secondSelectedTile.x)/l.tileWidth,i=Math.abs(this.firstSelectedTile.y-this.secondSelectedTile.y)/l.tileHeight;1===e&&0===i||0===e&&1===i?(this.canMove=!1,this.firstSelectedTile.getDeselected(),this.swapTiles()):(this.firstSelectedTile.getDeselected(),this.firstSelectedTile=this.secondSelectedTile,this.firstSelectedTile.getSelected(),this.secondSelectedTile=void 0)}else this.firstSelectedTile=t,this.firstSelectedTile.getSelected(),console.log("pick")}swapTiles(){if(this.firstSelectedTile&&this.secondSelectedTile){let e={x:this.firstSelectedTile.x-l.tileWidth/2,y:this.firstSelectedTile.y-l.tileHeight/2},t={x:this.secondSelectedTile.x-l.tileWidth/2,y:this.secondSelectedTile.y-l.tileHeight/2};this.tileGrid.getTileGrid()[e.y/l.tileHeight][e.x/l.tileWidth]=this.secondSelectedTile,this.tileGrid.getTileGrid()[t.y/l.tileHeight][t.x/l.tileWidth]=this.firstSelectedTile,this.add.tween({targets:this.firstSelectedTile,x:this.secondSelectedTile.x,y:this.secondSelectedTile.y,ease:"Linear",duration:400,repeat:0,yoyo:!1}),this.add.tween({targets:this.secondSelectedTile,x:this.firstSelectedTile.x,y:this.firstSelectedTile.y,ease:"Linear",duration:400,repeat:0,yoyo:!1,onComplete:()=>{this.checkMatches()}}),this.firstSelectedTile=this.tileGrid.getTileGrid()[e.y/l.tileHeight][e.x/l.tileWidth],this.secondSelectedTile=this.tileGrid.getTileGrid()[t.y/l.tileHeight][t.x/l.tileWidth]}}mergeMatch(e,t){let i=!1;for(var s=0;s<e.length;s++){var l=e[s];if(4===l.length){const e=l[0].x,t=l[0].y;for(let s=1;s<l.length;s++){const h=l[s];let n=this.getTilePos(this.tileGrid.getTileGrid(),h);i=!0,this.add.tween({targets:h,x:e,y:t,ease:"Linear",duration:200,onComplete:()=>{r.getInstance(this).returnTile(h),this.tileGrid.getTileGrid()[n.y][n.x]=void 0}})}l[0].enableCombine4()}else if(l.length>=5){const e=l[0].x,t=l[0].y;for(let s=1;s<l.length;s++){const h=l[s];let n=this.getTilePos(this.tileGrid.getTileGrid(),h);i=!0,this.add.tween({targets:h,x:e,y:t,ease:"Linear",duration:200,onComplete:()=>{r.getInstance(this).returnTile(h),this.tileGrid.getTileGrid()[n.y][n.x]=void 0}})}l[0].enableCombine5()}}i?this.time.delayedCall(200,t,void 0,this):t()}checkMatches(){let e=this.getMatches(this.tileGrid.getTileGrid());e.length>0?this.mergeMatch(e,(()=>{this.removeTileGroup(e,(()=>this.time.delayedCall(300,(()=>{this.resetTile((()=>{this.time.delayedCall(300,(()=>{this.tileUp(),this.checkMatches()}))}))}))))})):(this.swapTiles(),this.tileUp(),this.canMove=!0)}resetTile(e){return t=this,i=void 0,h=function*(){for(let e=this.tileGrid.getTileGrid().length-1;e>0;e--)for(let t=this.tileGrid.getTileGrid()[e].length-1;t>=0;t--)if(void 0===this.tileGrid.getTileGrid()[e][t]){let i=!1;for(let s=e-1;s>=0;s--)if(void 0!==this.tileGrid.getTileGrid()[s][t]){let h=this.tileGrid.getTileGrid()[s][t];this.tileGrid.getTileGrid()[e][t]=h,this.tileGrid.getTileGrid()[s][t]=void 0,this.add.tween({targets:h,y:l.tileHeight*e+l.tileHeight/2,ease:"Bounce.easeOut",duration:300,repeat:0,yoyo:!1,autoDestroy:!0}),i=!0;break}i&&(t=this.tileGrid.getTileGrid()[e].length)}for(let e=this.tileGrid.getTileGrid().length-1;e>=0;e--)for(let t=0;t<this.tileGrid.getTileGrid()[e].length;t++)if(void 0===this.tileGrid.getTileGrid()[e][t]){let i=r.getInstance(this).getTile(t,e);i.y=-(l.tileHeight*(this.tileGrid.getTileGrid().length-e)+l.tileHeight/2),this.add.tween({targets:i,y:l.tileHeight*e+l.tileHeight/2,ease:"Bounce.easeOut",duration:300,repeat:0,yoyo:!1}),this.tileGrid.getTileGrid()[e][t]=i}e()},new((s=void 0)||(s=Promise))((function(e,l){function r(e){try{d(h.next(e))}catch(e){l(e)}}function n(e){try{d(h.throw(e))}catch(e){l(e)}}function d(t){var i;t.done?e(t.value):(i=t.value,i instanceof s?i:new s((function(e){e(i)}))).then(r,n)}d((h=h.apply(t,i||[])).next())}));var t,i,s,h}tileUp(){this.firstSelectedTile=void 0,this.secondSelectedTile=void 0}removeTileGroup(e,t){let i=e.filter((e=>3===e.length));for(var s=0;s<i.length;s++){var l=i[s];for(let e=0;e<l.length;e++){let t=l[e],i=this.getTilePos(this.tileGrid.getTileGrid(),t);-1!==i.x&&-1!==i.y&&this.tileGrid.handleExplode(t)}}t()}getTilePos(e,t){let i={x:-1,y:-1};for(let s=0;s<e.length;s++)for(let l=0;l<e[s].length;l++)if(t===e[s][l]){i.x=l,i.y=s;break}return i}getMatches(e){let t=[],i=[];for(let e=0;e<l.gridRows;e++)for(let t=0;t<l.gridColumns;t++)this.visited[e][t]=!1;for(let i=0;i<e.length;i++){let s=e[i];for(let l=0;l<s.length;l++){if(!s[l]||this.visited[i][l])continue;let h=[];h.push(s[l]),this.visited[i][l]=!0;let r=[],n=[];for(let e=l+1;e<s.length&&s[e]&&s[l].texture.key===s[e].texture.key&&!this.visited[i][e];e++)r.push(s[e]),n.push({x:e,y:i}),this.visited[i][e]=!0;let d=[],o=[];for(let e=l-1;e>=0&&s[e]&&s[l].texture.key===s[e].texture.key&&!this.visited[i][e];e--)d.push(s[e]),o.push({x:e,y:i}),this.visited[i][e]=!0;let a=[],c=[];for(let t=i+1;t<e.length&&e[t][l]&&e[i][l].texture.key===e[t][l].texture.key&&!this.visited[t][l];t++)a.push(e[t][l]),c.push({x:l,y:t}),this.visited[t][l]=!0;let g=[],p=[];for(let t=i-1;t>=0&&e[t][l]&&e[i][l].texture.key===e[t][l].texture.key&&!this.visited[t][l];t--)g.push(e[t][l]),p.push({x:l,y:t}),this.visited[t][l]=!0;r.length+d.length>=2&&a.length+g.length>=2?(h.push(...r),h.push(...d),h.push(...a),h.push(...g),t.push(h)):(this.visited[i][l]=!1,n.forEach((e=>{this.visited[e.y][e.x]=!1})),o.forEach((e=>{this.visited[e.y][e.x]=!1})),c.forEach((e=>{this.visited[e.y][e.x]=!1})),p.forEach((e=>{this.visited[e.y][e.x]=!1})))}}for(let s=0;s<e.length;s++){let l=e[s];for(let e=0;e<l.length;e++){if(!l[e]||this.visited[s][e])continue;i=[],i.push(l[e]),this.visited[s][e]=!0;let h=[];for(let t=e+1;t<l.length&&l[t]&&l[e].texture.key===l[t].texture.key&&!this.visited[s][t];t++)h.push(l[t]),this.visited[s][t]=!0;if(h.length>=2)i.push(...h),t.push(i);else{this.visited[s][e]=!1;for(let e=0;e<h.length;e++){let t=this.getTilePos(this.tileGrid.getTileGrid(),h[e]);this.visited[t.y][t.x]=!1}}}}for(let s=0;s<e.length;s++){let l=e[s];for(let h=0;h<l.length;h++){if(!l[h]||this.visited[s][h])continue;i=[],i.push(l[h]),this.visited[s][h]=!0;let r=[];for(let t=s+1;t<e.length&&e[t][h]&&e[s][h].texture.key===e[t][h].texture.key&&!this.visited[t][h];t++)r.push(e[t][h]),this.visited[t][h]=!0;if(r.length>=2)i.push(...r),t.push(i);else{this.visited[s][h]=!1;for(let e=0;e<r.length;e++){let t=this.getTilePos(this.tileGrid.getTileGrid(),r[e]);this.visited[t.y][t.x]=!1}}}}return t}}const o={title:"Candy crush",url:"https://github.com/digitsensitive/phaser3-typescript",version:"0.0.1",width:700,height:window.innerHeight,type:Phaser.AUTO,parent:"game",scene:[s,d],backgroundColor:"#de3412",render:{pixelArt:!1,antialias:!0},scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},physics:{default:"arcade",arcade:{debug:!0,gravity:{x:0,y:0}}}};class a extends Phaser.Game{constructor(e){super(e)}}window.addEventListener("load",(()=>{new a(o)}))}},i={};function s(e){var l=i[e];if(void 0!==l)return l.exports;var h=i[e]={exports:{}};return t[e].call(h.exports,h,h.exports,s),h.exports}s.m=t,e=[],s.O=(t,i,l,h)=>{if(!i){var r=1/0;for(a=0;a<e.length;a++){for(var[i,l,h]=e[a],n=!0,d=0;d<i.length;d++)(!1&h||r>=h)&&Object.keys(s.O).every((e=>s.O[e](i[d])))?i.splice(d--,1):(n=!1,h<r&&(r=h));if(n){e.splice(a--,1);var o=l();void 0!==o&&(t=o)}}return t}h=h||0;for(var a=e.length;a>0&&e[a-1][2]>h;a--)e[a]=e[a-1];e[a]=[i,l,h]},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={792:0};s.O.j=t=>0===e[t];var t=(t,i)=>{var l,h,[r,n,d]=i,o=0;if(r.some((t=>0!==e[t]))){for(l in n)s.o(n,l)&&(s.m[l]=n[l]);if(d)var a=d(s)}for(t&&t(i);o<r.length;o++)h=r[o],s.o(e,h)&&e[h]&&e[h][0](),e[h]=0;return s.O(a)},i=self.webpackChunktype_project_template=self.webpackChunktype_project_template||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var l=s.O(void 0,[96],(()=>s(113)));l=s.O(l)})();